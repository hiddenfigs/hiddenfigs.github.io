{{ define "main" }}
  {{ $wellClass := `mx-auto max-w-screen-md` }}


  <!-- Main Section with Logo and Title -->
  <section
    class="parallax bg-gray p-8"
    style="background-image: url(/img/background/titleBackground.webp);"
  >
    <h1>
      <span class="sr-only">{{ .Title }}</span>
      {{ $img := resources.Get `img/logos/hiddenfigs_logo.png` }}
      {{ $imgSmall := $img.Resize "400x" }}
      {{ $imgMedium := $img.Resize "1000x" }}
      <img
        title="{{ $.Title }}"
        class="mx-auto h-auto w-[400px] max-w-full"
        alt="Hidden Figures logo"
        width="{{ $imgSmall.Width }}"
        height="{{ $imgSmall.Height }}"
        src="{{ $imgSmall.RelPermalink }}"
        srcset="
          {{ $imgSmall.RelPermalink }} 450w,
          {{ $imgMedium.RelPermalink }} 900w
        "
      />
    </h1>
    <h2
      class="links-blue-darker text-center font-sans text-xl leading-tight text-white md:text-xl"
    >
      A Cottrell Scholars Collaborative funded by the
      <a class="font-bold" href="https://rescorp.org/"
        >Research Corporation for Science Advancement</a
      >
    </h2>
    <div class="content-area mx-auto mt-8 max-w-prose text-white">
      {{ .Content }}
    </div>
  </section>
  <!-- Parallax effect CSS -->
  <style>
    .parallax {
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }
  </style>

  <!-- Section with Call-to-Action Links -->
  <section
    class="flex flex-col justify-around space-y-4 bg-gray shadow-inner sm:flex-row sm:space-x-4 sm:space-y-0"
    x-data="{ isOpen: false, showModal: false }"
  >
    {{ $blkClass := `group relative block w-full p-2 text-center leading-tight duration-100 sm:w-64` }}
    {{ $hedClass := `text-gray font-sans font-bold uppercase group-hover:text-white duration-100` }}
    {{ $dekClass := `my-1 mx-auto max-w-xs font-serif text-g-7` }}


    <!-- Add an Entry Button -->
    <a
      class="system {{ $blkClass }}"
      href="https://forms.gle/ZRopiyBevpXu9D459"
      target="_blank"
    >
      <div class="planet">
        <div>
          <div class="{{ $hedClass }}">Add an entry</div>
          or recommend someone and we will follow up
        </div>
      </div>
      <div class="orbit">
        <div class="moon"></div>
      </div>
    </a>

    <!-- Update Entry Button -->
    {{ $emailSubject := `About my Hidden Figures database entry` }}
    <a
      class="system {{ $blkClass }}"
      href="mailto:hiddenfigs@googlegroups.com?subject={{ $emailSubject }}"
      @click.prevent="showModal = true; console.log(showModal)"
    >
      <div class="planet">
        <div>
          <div class="{{ $hedClass }}">Update entry.</div>
          Let us know if your information changed
        </div>
      </div>
      <div class="orbit">
        <div class="moon"></div>
      </div>
    </a>
    
    <!-- Popup Modal -->
    <div
      x-show="showModal"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      x-cloak
      class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
    >
      <div
        class="transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:w-full sm:max-w-lg"
      >
        <div class="bg-gray px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
          <button
            @click="showModal = false"
            type="button"
            class="bg-red-600 hover:bg-red-700 focus:ring-red-500 mt-3 inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-base font-medium text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
          >
            Close
          </button>
        </div>
        <div class="px-4 py-5 sm:p-6">
          <h3 class="text-lg font-medium leading-6 text-black">Contact Us</h3>
          <div class="mt-2">
            <form>
              <div class="mb-4">
                <label
                  for="name"
                  class="text-gray-700 block text-sm font-medium"
                  >Name</label
                >
                <input
                  type="text"
                  name="name"
                  id="name"
                  class="border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 block w-full rounded-md shadow-sm sm:text-sm"
                />
              </div>
              <div class="mb-4">
                <label
                  for="email"
                  class="text-gray-700 block text-sm font-medium"
                  >Email</label
                >
                <input
                  type="email"
                  name="email"
                  id="email"
                  class="border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 block w-full rounded-md shadow-sm sm:text-sm"
                />
              </div>
              <div class="mb-4">
                <label
                  for="message"
                  class="text-gray-700 block text-sm font-medium"
                  >Message</label
                >
                <textarea
                  id="message"
                  name="message"
                  rows="4"
                  class="border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 block w-full rounded-md shadow-sm sm:text-sm"
                ></textarea>
              </div>
              <div class="flex justify-end">
                <button
                  type="submit"
                  class="bg-gray hover:bg-blue focus:ring-blue-500 mt-3 inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-base font-medium text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
                >
                  Send
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script>
      function submitForm(event) {
        event.preventDefault();
        
        let formData = {
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          message: document.getElementById('message').value
        };

        fetch('https://script.google.com/macros/s/AKfycbwlZYbDFD3_lT9q6UJSCk46rsVLXal5jhys3aFYQBCQEvCqIqUR5pN4lsn7vmqvPF7-/exec', {  // Replace with your Google Apps Script Web App URL
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
          alert('Your message has been sent successfully!');
        })
        .catch((error) => {
          console.error('Error:', error);
          alert('Failed to send your message.');
        });
      }

      document.querySelector('form').addEventListener('submit', submitForm);
    </script>
  </section>

  <style>
    .system {
      perspective: 1000px;
      transform-style: preserve-3d;
      height: 300px;
      aspect-ratio: 1;
      rotate: 45deg;
      position: relative; /* Make sure it can contain absolutely positioned elements */
    }

    .planet,
    .orbit,
    .moon {
      position: absolute;
      transform-style: preserve-3d;
      inset: 0;
      height: calc(var(--size) * 1%);
      margin: auto;
      aspect-ratio: 1;
      border-radius: 50%;
    }

    .planet {
      --size: 50;
      background: radial-gradient(circle at 40% 40%, #1e90ff, #104e8b 70%);
      border-radius: 50%;
      box-shadow:
        inset -20px -20px 30px rgba(0, 0, 0, 0.4),
        inset 10px 10px 20px rgba(255, 255, 255, 0.2),
        0 0 30px rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      rotate: -45deg;
    }

    .orbit {
      --size: 80;
      --duration: 6s;
      box-shadow:
        0 0 0 2cqmin #5554,
        inset 0 0 0 2cqmin #5554; /* Orbit outline */
      animation: orbit calc(var(--duration)) linear infinite;
      rotate: 1 0 0 80deg;
      animation-timing-function: linear;
      animation-play-state: running;
      will-change: transform;
    }

    .moon {
      --size: 24;
      height: calc(var(--size) * 1%);
      margin-left: calc(var(--size) * -0.5%);
      background: radial-gradient(circle at 30% 30%, #d3d3d3, #a9a9a9 70%);
      border-radius: 50%;
      position: relative;
      box-shadow:
        inset -10px -10px 30px rgba(0, 0, 0, 0.5),
        inset 10px 10px 20px rgba(255, 255, 255, 0.2),
        0 0 30px rgba(255, 255, 255, 0.1);
      animation: moon calc(var(--duration)) linear infinite;
      rotate: 1 0 0 90deg;
      animation-timing-function: linear;
      animation-play-state: running;
      will-change: transform;
    }

    /* Orbit and Moon Animation */
    @keyframes orbit {
      to {
        transform: rotate3d(0, 0, 1, 360deg);
      }
    }

    @keyframes moon {
      to {
        transform: rotate3d(0, 1, 0, -360deg);
      }
    }

    /* Hover effect for smoother speed change */
    .group:hover .orbit,
    .group:hover .moon {
      animation-duration: 3s; /* Speed up the animation without resetting */
      transition: animation-duration 0.5s ease; /* Smooth transition for speeding up */
    }

    .planet-text {
      display: block;
      text-align: center;
      width: 80%;
      font-size: 14px;
    }

    /* Additional button styling */
    .group:hover .planet {
      background: #005faf; /* Change planet color on hover */
    }

    a {
      text-decoration: none;
    }
  </style>

  <!-- Search Section -->
  <section
    class="parallax relative overflow-hidden p-8 text-white"
    style="background-image: url(/img/background/bodyBackground.webp);"
  >
    <!-- Meteors -->
    <div class="meteor meteor-1"></div>
    <div class="meteor meteor-2"></div>
    <div class="meteor meteor-3"></div>
    <div class="meteor meteor-4"></div>

    <section class="no-js-hide p-8">
      {{ partial "search.html" . }}
    </section>

    <!-- Section to Meet Our Scientists -->
    {{ $secHedClass := `text-2xl font-sans font-bold leading-tight mb-2` }}
    <section class="p-8 pt-0">
      <div class="{{ $wellClass }}" x-data>
        <h2 class="{{ $secHedClass }} scroll-mt-2" x-ref="hed">
          Meet our Scientists
        </h2>
        {{ $scientists := .GetPage "scientist" }}
        {{ $people := $scientists.RegularPages }}
        <ul
          x-init="$shuffle($el)"
          class="first-half-dozen mt-4 grid max-w-screen-md gap-x-4 gap-y-4 sm:grid-cols-2 md:grid-cols-3"
          x-ref="container"
        >
          {{ range $people }}
            <li class="min-w-0">
              {{ partial "person-box.html" . }}
            </li>
          {{ end }}
        </ul>
        <div class="mt-4 text-right font-sans font-bold">
          <p>
            <button
              type="button"
              @click="$rotate($refs.container, 6); $refs.hed.scrollIntoView({ block: 'start', behavior: 'smooth' });"
              class="decoration-blue decoration-4 underline-offset-2 transition-colors duration-500 hover:underline"
            >
              And many more…
            </button>
          </p>
        </div>
      </div>
    </section>
  </section>

  <style>
    .meteor {
      position: absolute; /* Positioned relative to the section */
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, white, transparent);
      border-radius: 50%;
      transform: rotate(45deg);
      opacity: 0.8;
    }

    /* Individual meteor start positions relative to the section */
    .meteor-1 {
      top: 0;
      right: 0;
    }
    .meteor-2 {
      top: 0;
      right: 20px;
    }
    .meteor-3 {
      top: 0;
      right: 40px;
    }
    .meteor-4 {
      top: 0;
      right: 60px;
    }
  </style>

  <script>
    document.addEventListener("scroll", () => {
      const section = document.querySelector(".parallax"); // Get the section
      const sectionTop = section.offsetTop; // Get section's top offset relative to the page
      const scrollPosition = window.scrollY;

      // Check if the section is in view
      if (scrollPosition >= sectionTop) {
        const relativeScroll = scrollPosition - sectionTop; // Scroll relative to the section

        // Select all meteors
        const meteors = document.querySelectorAll(".meteor");

        // Adjust position of each meteor based on scroll amount
        meteors.forEach((meteor, index) => {
          const speed = (index + 1) * 0.5; // Each meteor moves at a different speed
          const xMovement = relativeScroll * speed; // Horizontal movement (to the left)
          const yMovement = relativeScroll * speed; // Vertical movement (downward)

          meteor.style.transform = `translate(-${xMovement}px, -${yMovement}px) rotate(45deg)`;
        });
      }
    });
  </script>

  <!-- Section by Area of Expertise -->
  <section class="bg-g-3 p-8 shadow-inner">
    <div class="{{ $wellClass }}" x-data="{ isOpen: false }">
      <h2 class="{{ $secHedClass }}" id="by-beat">
        <button
          @click="isOpen = !isOpen"
          :aria-expanded="isOpen"
          class="text-left"
        >
          <span x-show="isOpen" x-cloak aria-hidden="true" class=""
            >&minus;</span
          >
          <span x-show="!isOpen" aria-hidden="true" class=""> &plus; </span>
          <span>Scientist by research area</span>
        </button>
      </h2>
      <div x-cloak x-show="isOpen" x-collapse>
        {{ $area := .GetPage "researchAreas" }}
        {{ partial "pages-list.html" $area.Pages }}
      </div>
    </div>
  </section>

  <!-- Section by Relevant Course Work -->
  <section class="p-8">
    <div class="{{ $wellClass }}" x-data="{ isOpen: false }">
      <h2 class="{{ $secHedClass }}" id="by-area">
        <button
          @click="isOpen = !isOpen"
          :aria-expanded="isOpen"
          class="text-left"
        >
          <span x-show="isOpen" x-cloak aria-hidden="true" class=""
            >&minus;</span
          >
          <span x-show="!isOpen" aria-hidden="true" class=""> &plus; </span>
          <span>Scientists by relevant course work</span>
        </button>
      </h2>
      <div x-cloak x-show="isOpen" x-collapse>
        {{ $course := .GetPage "relevantCourses" }}
        {{ partial "pages-list.html" $course.Pages }}
      </div>
    </div>
  </section>

  <!-- Section by Scientist Last Name -->
  <section class="bg-g-3 p-8 shadow-inner">
    <div class="{{ $wellClass }}" x-data="{ isOpen: false }">
      <h2 class="{{ $secHedClass }}" id="scientist">
        <button
          @click="isOpen = !isOpen"
          :aria-expanded="isOpen"
          class="text-left"
        >
          <span x-show="isOpen" x-cloak aria-hidden="true" class=""
            >&minus;</span
          >
          <span x-show="!isOpen" aria-hidden="true" class=""> &plus; </span>
          <span>Scientist by last name</span>
        </button>
      </h2>
      <div x-cloak x-show="isOpen" x-collapse>
        {{ $people := .GetPage "scientist" }}
        {{ partial "people-by-last-name.html" $people }}
      </div>
    </div>
  </section>
{{ end }}
